<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Lista de Jogos TSG</title>

  <style>
    :root{
      --bg:#eef1f3;
      --card:#fff;
      --accent:#1a73e8;
      --accent-dark:#1558b0;
      --muted:#666;
      --text:#111;
      font-family:Inter, system-ui, Arial;
    }

    *{ box-sizing:border-box; margin:0; padding:0; }

    body{
      background:var(--bg);
      color:var(--text);
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      padding:16px;
    }

    main{ max-width:960px; margin:0 auto 80px; }

    .header{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      gap:4px;
      margin-bottom:16px;
      text-align:center;
    }

    .logo{
      width:80px;
      height:80px;
      object-fit:cover;
      border-radius:50%;
    }

    h1{
      font-size:1.6rem;
      font-weight:700;
      letter-spacing:0.03em;
      margin-top:4px;
    }

    .game-counter{ font-size:0.85rem; color:var(--muted); margin-top:2px; }

    .legend{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:32px;
      margin-top:6px;
      font-size:0.8rem;
      color:var(--muted);
      white-space:nowrap;
    }

    .legend-item{ display:inline-flex; align-items:center; gap:6px; }

    .circle{ width:12px; height:12px; border-radius:50%; display:inline-block; }
    .circle.green{ background:#2e7d32; }
    .circle.red{ background:#c62828; }

    .toolbar{
      display:flex;
      gap:10px;
      margin:4px 0 14px;
      flex-wrap:wrap;
      align-items:flex-start;
    }

    .toolbar input[type="search"]{
      flex:1;
      min-width:180px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid #ccd0d5;
      font-size:0.9rem;
      outline:none;
    }

    .toolbar input[type="search"]:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 1px rgba(26,115,232,0.3);
    }

    .hint{ font-size:0.75rem; color:var(--muted); width:100%; }

    .cards{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      gap:14px;
      margin-top:10px;
    }

    .card{
      background:var(--card);
      border-radius:12px;
      box-shadow:0 6px 16px rgba(15,23,42,0.10);
      padding:12px 12px 10px;
      display:flex;
      flex-direction:column;
      gap:8px;
      position:relative;
      overflow:hidden;
    }

    .card h3{ font-size:1rem; margin-bottom:2px; }
    .card .price{ font-size:0.85rem; color:#1f2933; font-weight:600; }
    .creator{ font-size:0.75rem; color:var(--muted); }

    .quota-row{
      display:flex;
      align-items:center;
      margin-top:4px;
      padding:4px 0;
      border-top:1px solid #edf1f5;
      gap:8px;
    }
    .quota-row:first-of-type{ margin-top:6px; }

    .qt-main{ display:flex; align-items:center; gap:8px; min-width:0; }

    .qt-main .owner{
      font-size:0.78rem;
      color:#111827;
      max-width:180px;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:1px 7px;
      border-radius:999px;
      font-size:0.7rem;
      font-weight:600;
      letter-spacing:0.03em;
      text-transform:uppercase;
      min-width:110px;
      box-sizing:border-box;
      white-space:nowrap;
    }

    .badge.prim1{ background:rgba(76,175,80,0.12); color:#256029; }
    .badge.prim2{ background:rgba(33,150,243,0.12); color:#0b4f81; }
    .badge.sec{   background:rgba(255,193,7,0.16); color:#8a6d1a; }

    .quota-right{
      display:flex;
      align-items:center;
      gap:8px;
      margin-left:auto;
      font-size:0.78rem;
    }

    .quota-price{ font-weight:600; }

    .card-actions{
      display:flex;
      justify-content:flex-end;
      gap:6px;
      margin-top:8px;
    }

    .btn{
      font-size:0.75rem;
      border-radius:999px;
      border:1px solid transparent;
      padding:6px 12px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:4px;
      background:#f3f4f6;
      color:#111827;
      line-height:1;
      white-space:nowrap;
    }

    .btn-edit{ background:var(--accent); color:#fff; }
    .btn-edit:hover{ background:var(--accent-dark); }
    .btn-del{ background:#e5e5e5; color:#333; }

    .fab{
      position:fixed;
      right:22px;
      bottom:22px;
      width:62px;
      height:62px;
      border-radius:50%;
      background:var(--accent);
      color:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:2rem;
      border:none;
      cursor:pointer;
      box-shadow:0 10px 25px rgba(15,23,42,0.35);
      z-index:20;
    }

    .fab:hover{ background:var(--accent-dark); }

    .modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,0.50);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:30;
    }

    .hidden{ display:none; }

    .modal{
      background:#f9fafb;
      border-radius:14px;
      max-width:520px;
      width:100%;
      padding:16px 18px 14px;
      box-shadow:0 20px 45px rgba(15,23,42,0.5);
      max-height:90vh;
      overflow:auto;
    }

    .modal h2{ font-size:1.1rem; margin-bottom:10px; }
    .modal p{ font-size:0.8rem; color:var(--muted); margin-bottom:12px; }

    .modal label{
      display:block;
      font-size:0.8rem;
      margin-top:8px;
      margin-bottom:3px;
    }

    .modal input[type="text"],
    .modal input[type="number"],
    .modal input[type="email"],
    .modal input[type="url"]{
      width:100%;
      padding:7px 9px;
      border-radius:8px;
      border:1px solid #cbd5e1;
      font-size:0.85rem;
      margin-top:2px;
    }

    .modal input[type="text"]:focus,
    .modal input[type="number"]:focus,
    .modal input[type="email"]:focus,
    .modal input[type="url"]:focus{
      outline:none;
      border-color:var(--accent);
      box-shadow:0 0 0 1px rgba(26,115,232,0.3);
    }

    .quota-box{
      border-radius:10px;
      background:#eef2ff;
      padding:8px 10px;
      margin-top:8px;
    }

    .quota-box small{
      display:block;
      font-size:0.7rem;
      font-weight:600;
      letter-spacing:0.04em;
      text-transform:uppercase;
      color:#4b5563;
      margin-bottom:4px;
    }

    .quota-box label{
      display:flex;
      align-items:center;
      gap:6px;
      font-size:0.8rem;
      margin-top:5px;
      margin-bottom:0;
    }

    .quota-box input[type="text"]{ margin-top:2px; }

    input[type="checkbox"]{
      width:16px;
      height:16px;
      accent-color:#2e7d32;
    }

    .modal-actions{
      display:flex;
      justify-content:flex-end;
      gap:10px;
      margin-top:16px;
    }

    .btn-cancel{
      background:#ddd;
      color:#333;
      border:none;
      border-radius:999px;
      padding:6px 14px;
      font-size:0.8rem;
      cursor:pointer;
    }

    .btn-save{
      background:var(--accent);
      color:#fff;
      border:none;
      border-radius:999px;
      padding:6px 16px;
      font-size:0.8rem;
      cursor:pointer;
    }

    .btn-save:hover{ background:var(--accent-dark); }

    .cover{
      width:100%;
      height:190px;
      object-fit:cover;
      border-radius:9px;
      margin-bottom:6px;
      background:#d4d4d4;
    }

    .export-text{
      width:100%;
      min-height:280px;
      padding:10px;
      border-radius:10px;
      border:1px solid #cbd5e1;
      font-size:0.85rem;
      resize:vertical;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      background:#fff;
      white-space:pre;
    }

    @media(max-width:600px){
      body{ padding:10px; }
      .modal{ max-width:100%; padding:14px; }
      .fab{ right:16px; bottom:16px; }
    }
  </style>

  <!-- Firebase compat 9 -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>
</head>
<body>

<main>
  <header class="header">
    <img src="/Logo_tsg.png" class="logo" alt="TSG logo">
    <h1>Lista TSG</h1>
    <div id="gameCounter" class="game-counter">0 Jogos Catalogados</div>
    <div class="legend">
      <span class="legend-item">
        <span class="circle green"></span>
        <span>Disponível para negociação</span>
      </span>
      <span class="legend-item">
        <span class="circle red"></span>
        <span>Indisponível</span>
      </span>
    </div>
  </header>

  <section class="toolbar">
    <input id="search" type="search" placeholder="Filtrar por nome do jogo ou proprietário...">
    <button class="btn btn-edit" id="btnExport" type="button">Gerar lista</button>
    <div class="hint">Os valores exibidos são referentes às cotas, com base no valor pago na compra.</div>
  </section>

  <section id="list" class="cards"></section>
</main>

<button class="fab" id="btnNew" aria-label="Novo jogo">+</button>

<!-- MODAL: NOVO/EDITAR -->
<div class="modal-backdrop hidden" id="modal">
  <div class="modal">
    <h2 id="modalTitle">Novo jogo</h2>
    <p>Preencha os dados da conta e das cotas conforme a negociação combinada no grupo TSG.</p>

    <form id="form">

      <label>Nome do jogo
        <input type="text" name="game" required>
      </label>

      <label>Preço na compra (R$)
        <input type="number" step="0.01" name="valor" required>
      </label>

      <label>E-mail do criador da conta
        <input type="email" name="creator" required>
      </label>

      <label>Imagem (upload ou URL)
        <input type="file" id="fileImg" accept="image/*">
        <input type="url" name="imgUrl" placeholder="https://endereco-da-imagem-opcional">
      </label>

      <div class="quota-box">
        <small>Primária 1</small>
        <input type="text" name="prim1" placeholder="Nome">
        <label><input type="checkbox" name="prim1_avail"> Disponível para negociação</label>
      </div>

      <div class="quota-box">
        <small>Primária 2</small>
        <input type="text" name="prim2" placeholder="Nome">
        <label><input type="checkbox" name="prim2_avail"> Disponível para negociação</label>
      </div>

      <div class="quota-box">
        <small>Secundária</small>
        <input type="text" name="sec" placeholder="Nome">
        <label><input type="checkbox" name="sec_avail"> Disponível para negociação</label>
        <label><input type="checkbox" name="no_sec"> Conta sem cota secundária</label>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn-cancel" id="btnCancel">Cancelar</button>
        <button type="submit" class="btn-save">Salvar</button>
      </div>

    </form>

  </div>
</div>

<!-- MODAL: EXPORTAR LISTA EM TEXTO -->
<div class="modal-backdrop hidden" id="exportModal">
  <div class="modal">
    <h2>Lista em texto</h2>
    <p>O texto é copiado automaticamente ao abrir. Você pode só fechar ou clicar em “Copiar” para colapsar esta janela.</p>

    <label>Texto gerado</label>
    <textarea id="exportText" class="export-text" readonly></textarea>

    <div class="modal-actions">
      <button type="button" class="btn-cancel" id="btnExportClose">Fechar</button>
      <button type="button" class="btn-save" id="btnExportCopy">Copiar</button>
    </div>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBg_OX8aDvVfpJB3HOG8rCUv2GAd_bdbVM",
  authDomain: "lista-games-tsg.firebaseapp.com",
  projectId: "lista-games-tsg",
  storageBucket: "lista-games-tsg.appspot.com",
  messagingSenderId: "270184226460",
  appId: "1:270184226460:web:eb30d68d422b545b025759"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

firebase.auth().signInAnonymously().catch(console.error);

// refs
const list = document.getElementById("list");
const modal = document.getElementById("modal");
const form = document.getElementById("form");
const btnNew = document.getElementById("btnNew");
const btnCancel = document.getElementById("btnCancel");
const modalTitle = document.getElementById("modalTitle");
const gameCounter = document.getElementById("gameCounter");
const fileInput = document.getElementById("fileImg");

// export refs
const btnExport = document.getElementById("btnExport");
const exportModal = document.getElementById("exportModal");
const exportText = document.getElementById("exportText");
const btnExportCopy = document.getElementById("btnExportCopy");
const btnExportClose = document.getElementById("btnExportClose");

// cache dos jogos (para gerar texto)
let gamesCache = [];

let editId = null;
const noSecCheckbox = form.no_sec;

function applyNoSecState(checked){
  if(!form.sec || !form.sec_avail) return;
  if(checked){
    form.sec.value = "";
    form.sec.disabled = true;
    form.sec_avail.checked = false;
    form.sec_avail.disabled = true;
  } else {
    form.sec.disabled = false;
    form.sec_avail.disabled = false;
  }
}

if(noSecCheckbox){
  noSecCheckbox.addEventListener("change", ()=>{
    applyNoSecState(noSecCheckbox.checked);
  });
}

// formata R$ xx,xx
function formatBRL(v){
  const n = Number(v || 0);
  return "R$ " + n.toFixed(2).replace(".", ",");
}
function formatBRLCompact(v){
  return formatBRL(v).replace("R$ ", "R$");
}

function formatDateBR(date){
  const d = String(date.getDate()).padStart(2,"0");
  const m = String(date.getMonth()+1).padStart(2,"0");
  const y = String(date.getFullYear());
  return `${d}/${m}/${y}`;
}

function tsToDate(ts){
  if(!ts) return null;
  if(typeof ts.toDate === "function") return ts.toDate();
  if(typeof ts.seconds === "number") return new Date(ts.seconds * 1000);
  return null;
}

function getLatestNewGameDate(){
  let latest = null;
  for(const g of gamesCache){
    const d = tsToDate(g.createdAt) || tsToDate(g.updatedAt);
    if(!d) continue;
    if(!latest || d > latest) latest = d;
  }
  return latest;
}

// render linha de cota
function quotaRow(label, type, owner, avail, quotaValor, baseValor){
  let valNum;
  if(typeof quotaValor === "number" && !isNaN(quotaValor)){
    valNum = quotaValor;
  }else if(typeof baseValor === "number" && !isNaN(baseValor)){
    if(type === "prim1" || type === "prim2") valNum = baseValor * 0.4;
    else valNum = baseValor * 0.2;
  }else{
    valNum = 0;
  }
  const valorStr = valNum > 0 ? formatBRL(valNum) : "";

  return `
  <div class="quota-row">
    <div class="qt-main">
      <span class="badge ${type=='prim1'?'prim1':type=='prim2'?'prim2':'sec'}">${label}</span>
      <span class="owner">${owner || ""}</span>
    </div>
    <div class="quota-right">
      <span class="quota-price">${valorStr}</span>
      <span class="circle ${avail ? "green" : "red"}"></span>
    </div>
  </div>`;
}

// render card
function renderCard(id, data){
  const div = document.createElement("div");
  div.className = "card";

  const imgHtml = data.imageUrl
    ? `<img class="cover" src="${data.imageUrl}" alt="${data.game || "capa"}" onerror="this.style.display='none'">`
    : "";

  div.innerHTML = `
    ${imgHtml}
    <h3>${data.game}</h3>
    <div class="price">Preço na compra: ${formatBRL(data.valor)}</div>
    <div class="creator">Criador: ${data.creator}</div>

    ${quotaRow("PRIMÁRIA 1", "prim1", data.prim1, data.prim1_avail, data.prim1_valor, data.valor)}
    ${quotaRow("PRIMÁRIA 2", "prim2", data.prim2, data.prim2_avail, data.prim2_valor, data.valor)}
    ${!data.no_sec ? quotaRow("SECUNDÁRIA", "sec", data.sec, data.sec_avail, data.sec_valor, data.valor) : ""}

    <div class="card-actions">
      <button class="btn btn-edit" onclick="openEdit('${id}')">EDITAR</button>
      <button class="btn btn-del" onclick="delGame('${id}')">EXCLUIR</button>
    </div>
  `;

  list.appendChild(div);
}

// abrir modal novo
btnNew.onclick = () => {
  editId = null;
  form.reset();
  if(fileInput) fileInput.value = "";

  if(form.prim1_avail) form.prim1_avail.disabled = false;
  if(form.prim2_avail) form.prim2_avail.disabled = false;
  if(form.sec_avail) form.sec_avail.disabled = false;
  if(form.sec) form.sec.disabled = false;
  if(noSecCheckbox){
    noSecCheckbox.checked = false;
    applyNoSecState(false);
  }

  modalTitle.textContent = "Novo jogo";
  modal.classList.remove("hidden");
};

// fechar modal
btnCancel.onclick = () => modal.classList.add("hidden");

// abrir modal editar
window.openEdit = async (id)=>{
  editId = id;
  modalTitle.textContent = "Editar jogo";
  const snap = await db.collection("games").doc(id).get();
  const d = snap.data();

  form.game.value = d.game;
  form.valor.value = d.valor;
  form.creator.value = d.creator;
  form.imgUrl.value = d.imageUrl || "";
  if(fileInput) fileInput.value = "";

  form.prim1.value = d.prim1 || "";
  form.prim1_avail.checked = !!d.prim1_avail;

  form.prim2.value = d.prim2 || "";
  form.prim2_avail.checked = !!d.prim2_avail;

  form.sec.value = d.sec || "";
  form.sec_avail.checked = !!d.sec_avail;

  if(noSecCheckbox){
    const noSecFlag = !!d.no_sec;
    noSecCheckbox.checked = noSecFlag;
    applyNoSecState(noSecFlag);
  } else {
    applyNoSecState(false);
  }

  if(form.prim1_avail) form.prim1_avail.disabled = false;
  if(form.prim2_avail) form.prim2_avail.disabled = false;
  if(form.sec_avail && !(noSecCheckbox && noSecCheckbox.checked)) form.sec_avail.disabled = false;

  modal.classList.remove("hidden");
};

// excluir com senha
window.delGame = async (id)=>{
  const pwd = prompt("Senha de administrador para excluir o jogo:");
  if(!pwd) return;
  if(pwd !== "Tsg@delete"){
    alert("Senha incorreta.");
    return;
  }
  await db.collection("games").doc(id).delete();
};

// salvar (novo ou editar)
form.onsubmit = async (e)=>{
  e.preventDefault();
  try{
    const f = new FormData(form);
    const valorNumber = parseFloat(f.get("valor")) || 0;

    let data = {
      game: f.get("game"),
      valor: valorNumber,
      creator: f.get("creator"),
      prim1: f.get("prim1"),
      prim1_avail: !!f.get("prim1_avail"),
      prim2: f.get("prim2"),
      prim2_avail: !!f.get("prim2_avail"),
      sec: f.get("sec"),
      sec_avail: !!f.get("sec_avail"),
      no_sec: !!f.get("no_sec"),
      updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    };

    if(data.no_sec){
      data.sec = "";
      data.sec_avail = false;
    }

    const user = firebase.auth().currentUser;
    if(user){
      data.lastUpdatedBy = user.uid;
    }

    const file = fileInput && fileInput.files[0];
    if(file){
      const ref = storage.ref("covers/"+Date.now()+"_"+file.name);
      const snap = await ref.put(file);
      data.imageUrl = await snap.ref.getDownloadURL();
    } else if(f.get("imgUrl")){
      data.imageUrl = f.get("imgUrl");
    }

    // cálculo das cotas — sempre a partir do valor atual
    if(data.no_sec){
      data.prim1_valor = valorNumber * 0.5;
      data.prim2_valor = valorNumber * 0.5;
      data.sec_valor   = 0;
    }else{
      data.prim1_valor = valorNumber * 0.4;
      data.prim2_valor = valorNumber * 0.4;
      data.sec_valor   = valorNumber * 0.2;
    }

    if(editId){
      await db.collection("games").doc(editId).update(data);
    } else {
      data.createdAt  = firebase.firestore.FieldValue.serverTimestamp();
      await db.collection("games").add(data);
    }

    modal.classList.add("hidden");
  }catch(err){
    console.error("Erro ao salvar:", err);
    alert("Ocorreu um erro ao salvar. Veja o console do navegador (F12) para mais detalhes.");
  }
};

/* ========= EXPORTAR LISTA (TEXTO) ========= */

function getPrimaryQuotaValue(g){
  if (typeof g.prim1_valor === "number" && !isNaN(g.prim1_valor)) return g.prim1_valor;
  const total = Number(g.valor || 0);
  if (!total) return 0;
  if (g.no_sec) return total * 0.5;
  return total * 0.4;
}

function getSearchQuery(){
  const el = document.getElementById("search");
  return (el?.value || "").trim().toLowerCase();
}

function matchesQuery(game, q){
  if(!q) return true;
  const fields = [
    game.game,
    game.prim1, game.prim2, game.sec,
    game.creator
  ].filter(Boolean).join(" ").toLowerCase();
  return fields.includes(q);
}

function buildTextList(){
  const q = getSearchQuery();
  const filtered = gamesCache.filter(g => matchesQuery(g, q));

  const lines = [];
  lines.push("LISTA DE JOGOS TSG");

  const latest = getLatestNewGameDate();
  lines.push(latest ? `Atualizada em ${formatDateBR(latest)}` : "Atualizada em --/--/----");

  // espaço entre cabeçalho e corpo
  lines.push("");

  filtered.forEach((g, idx) => {
    const num = String(idx + 1).padStart(2, "0");
    const name = (g.game || "").trim();
    const primaryQuota = getPrimaryQuotaValue(g);
    const price = formatBRLCompact(primaryQuota);

    lines.push(`${num} - ${name} (${price})`);

    // espaço entre itens (não depois do último)
    if(idx !== filtered.length - 1){
      lines.push("");
    }
  });

  if(filtered.length === 0){
    lines.push("(Nenhum jogo encontrado com esse filtro.)");
  }

  // rodapé em 2 linhas (texto atualizado)
  lines.push("");
  lines.push("Obs.: Os preços referem-se ao valor da cota no momento da compra do jogo.");
  lines.push("A disponibilidade e preço devem ser checados com os devidos proprietários.");

  return lines.join("\n");
}

async function copyToClipboard(text){
  try{
    await navigator.clipboard.writeText(text);
    return true;
  }catch(e){
    try{
      exportText.value = text;
      exportText.focus();
      exportText.select();
      const ok = document.execCommand("copy");
      window.getSelection && window.getSelection().removeAllRanges();
      exportText.blur();
      return !!ok;
    }catch(_){
      return false;
    }
  }
}

function openExport(){
  const text = buildTextList();
  exportText.value = text;

  exportModal.classList.remove("hidden");

  // não deixar selecionado
  if (document.activeElement) document.activeElement.blur();
  window.getSelection && window.getSelection().removeAllRanges();

  // copia automaticamente
  copyToClipboard(text).then((ok)=>{
    if(btnExportCopy){
      const original = btnExportCopy.textContent;
      btnExportCopy.textContent = ok ? "Copiado ✓" : "Copiar";
      setTimeout(()=>{ btnExportCopy.textContent = original; }, 900);
    }
  });
}

function closeExport(){
  exportModal.classList.add("hidden");
}

btnExport.onclick = () => openExport();
btnExportClose.onclick = () => closeExport();

// botão "Copiar" vira "OK / fechar" (mantém o nome)
btnExportCopy.onclick = () => closeExport();

exportModal.addEventListener("click", (e)=>{
  if(e.target === exportModal) closeExport();
});

/* ========= LISTENER EM TEMPO REAL ========= */

db.collection("games")
  .orderBy("game","asc")
  .onSnapshot(snap=>{
    list.innerHTML = "";
    gameCounter.innerText = `${snap.size} Jogos Catalogados`;

    gamesCache = [];
    snap.forEach(doc => {
      const data = doc.data();
      gamesCache.push({ id: doc.id, ...data });
      renderCard(doc.id, data);
    });
  });

// busca por nome do jogo OU proprietários (filtra só os cards)
document.getElementById("search").oninput = (e)=>{
  const q = e.target.value.toLowerCase();

  Array.from(list.children).forEach(card=>{
    const title = card.querySelector("h3").textContent.toLowerCase();
    const ownersText = Array.from(card.querySelectorAll(".owner"))
      .map(el => el.textContent.toLowerCase())
      .join(" ");
    const textoBusca = title + " " + ownersText;
    card.style.display = textoBusca.includes(q) ? "" : "none";
  });
};
</script>

</body>
</html>